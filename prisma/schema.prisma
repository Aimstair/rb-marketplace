generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                                           String                    @id @default(cuid())
  username                                     String                    @unique
  email                                        String                    @unique
  password                                     String?
  role                                         String                    @default("user")
  profilePicture                               String?
  banner                                       String?
  bio                                          String?
  joinDate                                     DateTime                  @default(now())
  robloxProfile                                String?
  discordTag                                   String?
  createdAt                                    DateTime                  @default(now())
  updatedAt                                    DateTime                  @updatedAt
  isVerified                                   Boolean                   @default(false)
  lastActive                                   DateTime                  @default(now())
  socialLinks                                  Json?
  isBanned                                     Boolean                   @default(false)
  subscriptionEndsAt                           DateTime?
  subscriptionStatus                           String                    @default("ACTIVE")
  subscriptionTier                             String                    @default("FREE")
  emailVerified                                DateTime?
  customRoleId                                 String?
  isMuted                                      Boolean                   @default(false)
  mutedReason                                  String?
  mutedUntil                                   DateTime?
  failedLoginAttempts                          Int                       @default(0)
  lockedUntil                                  DateTime?
  salesResetMonth                              DateTime                  @default(now())
  salesResetWeek                               DateTime                  @default(now())
  totalSalesThisMonth                          Float                     @default(0)
  totalSalesThisWeek                           Float                     @default(0)
  accounts                                     Account[]
  audit_logs                                   audit_logs[]
  conversations1                               Conversation[]            @relation("Buyer")
  conversations2                               Conversation[]            @relation("Seller")
  currencyListings                             CurrencyListing[]
  itemListings                                 ItemListing[]
  listing_votes                                listing_votes[]
  messagesSent                                 Message[]                 @relation("Sender")
  notifications                                Notification[]
  payments                                     Payment[]
  report_listings                              report_listings[]
  report_users_report_users_reportedIdTousers  report_users[]            @relation("report_users_reportedIdTousers")
  report_users_report_users_reporterIdTousers  report_users[]            @relation("report_users_reporterIdTousers")
  sessions                                     Session[]
  subscription_logs                            subscription_logs[]
  support_ticket_messages                      support_ticket_messages[]
  support_tickets                              support_tickets[]
  transactions1                                Transaction[]             @relation("BuyerTransactions")
  transactions2                                Transaction[]             @relation("SellerTransactions")
  user_follows_user_follows_followerIdTousers  user_follows[]            @relation("user_follows_followerIdTousers")
  user_follows_user_follows_followingIdTousers user_follows[]            @relation("user_follows_followingIdTousers")
  user_preferences                             user_preferences?
  roles                                        roles?                    @relation(fields: [customRoleId], references: [id])
  vouches_vouches_fromUserIdTousers            vouches[]                 @relation("vouches_fromUserIdTousers")
  vouches_vouches_toUserIdTousers              vouches[]                 @relation("vouches_toUserIdTousers")

  @@map("users")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model EmailVerification {
  id        String   @id @default(cuid())
  email     String
  code      String
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([email])
  @@index([code])
  @@map("email_verifications")
}

model PasswordReset {
  id        String   @id @default(cuid())
  email     String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([email])
  @@index([token])
  @@map("password_resets")
}

model Game {
  id               String            @id @default(cuid())
  name             String            @unique
  displayName      String
  description      String?
  image            String?
  isActive         Boolean           @default(true)
  order            Int               @default(0)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  currencyListings CurrencyListing[]
  gameCurrencies   GameCurrency[]
  gameItems        GameItem[]
  itemListings     ItemListing[]

  @@index([isActive])
  @@index([order])
  @@map("games")
}

model GameItem {
  id           String        @id @default(cuid())
  gameId       String
  name         String
  displayName  String
  description  String?
  category     String
  itemType     String
  icon         String?
  isActive     Boolean       @default(true)
  order        Int           @default(0)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  game         Game          @relation(fields: [gameId], references: [id], onDelete: Cascade)
  itemListings ItemListing[] @relation("ItemListingGameItem")

  @@unique([gameId, name])
  @@index([gameId])
  @@index([category])
  @@index([isActive])
  @@map("game_items")
}

model GameCurrency {
  id               String            @id @default(cuid())
  gameId           String
  name             String
  displayName      String
  description      String?
  icon             String?
  isActive         Boolean           @default(true)
  order            Int               @default(0)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  currencyListings CurrencyListing[] @relation("CurrencyListingGameCurrency")
  game             Game              @relation(fields: [gameId], references: [id], onDelete: Cascade)

  @@unique([gameId, name])
  @@index([gameId])
  @@index([isActive])
  @@map("game_currencies")
}

model ItemListing {
  id          String   @id @default(cuid())
  title       String
  description String?
  price       Int
  stock       Int      @default(1)
  image       String
  listingType String   @default("Item")
  condition   String
  status      String   @default("available")
  featured    Boolean  @default(false)
  views       Int      @default(0)
  upvotes     Int      @default(0)
  downvotes   Int      @default(0)
  sellerId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  gameId      String
  gameItemId  String
  pricingMode String   @default("per-item")
  game        Game     @relation(fields: [gameId], references: [id], onDelete: Cascade)
  gameItem    GameItem @relation("ItemListingGameItem", fields: [gameItemId], references: [id], onDelete: Cascade)
  seller      User     @relation(fields: [sellerId], references: [id], onDelete: Cascade)

  @@index([sellerId])
  @@index([status])
  @@index([gameId])
  @@index([gameItemId])
  @@map("item_listings")
}

model CurrencyListing {
  id             String       @id @default(cuid())
  title          String
  description    String?
  listingType    String       @default("Currency")
  ratePerPeso    Float
  stock          Int
  minOrder       Int
  maxOrder       Int
  image          String
  status         String       @default("available")
  featured       Boolean      @default(false)
  views          Int          @default(0)
  upvotes        Int          @default(0)
  downvotes      Int          @default(0)
  sellerId       String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  gameCurrencyId String
  gameId         String
  pricingMode    String       @default("per-peso")
  gameCurrency   GameCurrency @relation("CurrencyListingGameCurrency", fields: [gameCurrencyId], references: [id], onDelete: Cascade)
  game           Game         @relation(fields: [gameId], references: [id], onDelete: Cascade)
  seller         User         @relation(fields: [sellerId], references: [id], onDelete: Cascade)

  @@index([sellerId])
  @@index([status])
  @@index([gameId])
  @@index([gameCurrencyId])
  @@map("currency_listings")
}

model Conversation {
  id           String        @id @default(cuid())
  buyerId      String
  sellerId     String
  listingId    String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  listingType  String?
  buyer        User          @relation("Buyer", fields: [buyerId], references: [id], onDelete: Cascade)
  seller       User          @relation("Seller", fields: [sellerId], references: [id], onDelete: Cascade)
  messages     Message[]
  transactions Transaction[]

  @@index([buyerId])
  @@index([sellerId])
  @@index([listingId])
  @@map("conversations")
}

model Message {
  id              String       @id @default(cuid())
  conversationId  String
  senderId        String
  content         String
  attachmentUrl   String?
  isRead          Boolean      @default(false)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime
  offerAmount     Int?
  isSystemMessage Boolean      @default(false)
  offerStatus     String?      @default("pending")
  amount          Int?
  conversation    Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender          User         @relation("Sender", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([senderId])
  @@map("messages")
}

model Transaction {
  id              String        @id @default(cuid())
  buyerId         String
  sellerId        String
  listingId       String
  price           Int
  status          String        @default("PENDING")
  buyerConfirmed  Boolean       @default(false)
  sellerConfirmed Boolean       @default(false)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  amount          Int?
  conversationId  String?
  listingType     String
  pricePerUnit    Float?
  totalPrice      Int?
  disputes        disputes?
  buyer           User          @relation("BuyerTransactions", fields: [buyerId], references: [id], onDelete: Cascade)
  conversation    Conversation? @relation(fields: [conversationId], references: [id])
  seller          User          @relation("SellerTransactions", fields: [sellerId], references: [id], onDelete: Cascade)
  vouches         vouches[]

  @@index([buyerId])
  @@index([sellerId])
  @@index([listingId])
  @@index([listingType])
  @@index([conversationId])
  @@map("transactions")
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  type      String
  title     String
  message   String
  link      String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
  @@map("notifications")
}

model Payment {
  id                String    @id @default(cuid())
  userId            String
  amount            Float
  currency          String    @default("PHP")
  status            String    @default("pending")
  provider          String
  providerPaymentId String
  type              String
  metadata          Json?
  paidAt            DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([providerPaymentId])
  @@index([status])
  @@map("payments")
}

model SystemSettings {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  category  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category])
  @@map("system_settings")
}

model announcements {
  id        String    @id
  title     String
  content   String
  type      String    @default("info")
  isActive  Boolean   @default(true)
  expiresAt DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime

  @@index([createdAt])
  @@index([isActive])
}

model audit_logs {
  id        String   @id
  adminId   String
  action    String
  targetId  String?
  details   String?
  createdAt DateTime @default(now())
  users     User     @relation(fields: [adminId], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([adminId])
  @@index([createdAt])
}

model disputes {
  id            String      @id
  transactionId String      @unique
  reason        String
  status        String      @default("OPEN")
  resolution    String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime
  transactions  Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([status])
  @@index([transactionId])
}

model filter_options {
  id        String   @id
  type      String
  label     String
  value     String
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@index([type])
}

model listing_views {
  id          String   @id
  listingId   String
  listingType String
  userId      String?
  sessionId   String?
  ipAddress   String?
  viewedAt    DateTime @default(now())

  @@unique([listingId, userId, sessionId])
  @@index([listingId])
  @@index([sessionId])
  @@index([userId])
}

model listing_votes {
  id          String   @id
  userId      String
  listingId   String
  type        String
  createdAt   DateTime @default(now())
  listingType String
  users       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, listingId])
  @@index([listingId])
  @@index([listingType])
  @@index([userId])
}

model report_listings {
  id          String   @id
  reporterId  String
  listingId   String
  listingType String
  reason      String
  details     String?
  status      String   @default("PENDING")
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  users       User     @relation(fields: [reporterId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([listingId])
  @@index([listingType])
  @@index([reporterId])
  @@index([status])
}

model report_users {
  id                                   String   @id
  reporterId                           String
  reportedId                           String
  reason                               String
  details                              String?
  status                               String   @default("PENDING")
  createdAt                            DateTime @default(now())
  updatedAt                            DateTime
  users_report_users_reportedIdTousers User     @relation("report_users_reportedIdTousers", fields: [reportedId], references: [id], onDelete: Cascade)
  users_report_users_reporterIdTousers User     @relation("report_users_reporterIdTousers", fields: [reporterId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([reportedId])
  @@index([reporterId])
  @@index([status])
}

model roles {
  id          String   @id
  name        String   @unique
  description String?
  color       String
  permissions String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  users       User[]

  @@index([createdAt])
  @@index([name])
}

model subscription_logs {
  id        String   @id
  userId    String
  plan      String
  amount    Int
  createdAt DateTime @default(now())
  users     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([userId])
}

model support_ticket_messages {
  id              String          @id
  ticketId        String
  userId          String
  message         String
  isAdmin         Boolean         @default(false)
  createdAt       DateTime        @default(now())
  support_tickets support_tickets @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  users           User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@index([userId])
}

model support_tickets {
  id                      String                    @id
  userId                  String
  subject                 String
  message                 String
  status                  String                    @default("OPEN")
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  category                String                    @default("GENERAL")
  priority                String                    @default("MEDIUM")
  support_ticket_messages support_ticket_messages[]
  users                   User                      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([status])
  @@index([userId])
}

model user_follows {
  id                                    String   @id
  followerId                            String
  followingId                           String
  createdAt                             DateTime @default(now())
  users_user_follows_followerIdTousers  User     @relation("user_follows_followerIdTousers", fields: [followerId], references: [id], onDelete: Cascade)
  users_user_follows_followingIdTousers User     @relation("user_follows_followingIdTousers", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

model user_preferences {
  id                    String   @id
  userId                String   @unique
  profileVisibility     Boolean  @default(true)
  showEmail             Boolean  @default(false)
  showRobloxProfile     Boolean  @default(true)
  showActivityStatus    Boolean  @default(true)
  allowMessageRequests  Boolean  @default(true)
  notifyNewMessages     Boolean  @default(true)
  notifyListingViews    Boolean  @default(true)
  notifyPriceAlerts     Boolean  @default(false)
  notifyVouches         Boolean  @default(true)
  notifyTradeUpdates    Boolean  @default(true)
  notifyMarketingEmails Boolean  @default(false)
  createdAt             DateTime @default(now())
  updatedAt             DateTime
  users                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model vouches {
  id                              String       @id
  fromUserId                      String
  toUserId                        String
  transactionId                   String?
  type                            String
  message                         String?
  rating                          Int          @default(5)
  createdAt                       DateTime     @default(now())
  invalidReason                   String?
  invalidatedAt                   DateTime?
  invalidatedBy                   String?
  status                          String       @default("VALID")
  users_vouches_fromUserIdTousers User         @relation("vouches_fromUserIdTousers", fields: [fromUserId], references: [id], onDelete: Cascade)
  users_vouches_toUserIdTousers   User         @relation("vouches_toUserIdTousers", fields: [toUserId], references: [id], onDelete: Cascade)
  transactions                    Transaction? @relation(fields: [transactionId], references: [id])

  @@index([fromUserId, toUserId])
  @@index([toUserId])
  @@index([transactionId])
}
